<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>GIS4102C Midterm - Marine Pollution Reports</title>

    <style>
      html,
      body,
      #viewDiv {
       padding: 0;
       margin: 0;
       height: 100%;
       width: 100%;
      }
   
       /* Setting the style of the button */
      .addRecordBtn {
    position: absolute;
    z-index: 10;
    top: 10px;
    right: 10px;
    background-color: #355c3e;
    color: white;
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    text-decoration: none;
      }
      .addRecordBtn:hover {
       background-color: #005a87;
      }
  
     </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.29/"></script>

    <script>
      require([
        "esri/config", 
        "esri/Map", 
        "esri/views/MapView", 
        "esri/layers/ImageryLayer", 
        "esri/layers/FeatureLayer", 
        "esri/widgets/Legend", 
        "esri/widgets/Search", 
        "esri/widgets/ScaleBar", 
        "esri/widgets/LayerList", 
        "esri/widgets/Expand"], 
        (esriConfig, 
        Map, 
        MapView, 
        ImageryLayer, 
        FeatureLayer, 
        Legend, 
        Search, 
        ScaleBar, 
        LayerList, 
        Expand) => {

      // Set the API key for the ArcGIS API for JavaScript
        esriConfig.apiKey = "AAPK7ec55599150b4a308e2cb5b3061951d0V031QmsxPbZowhaXDBb_7KJn4HhUyXv5Qxgp0vWFkAt5dqtugb17cRGjdusqdg6e";

        const map = new Map({
          basemap: "topographic"
         });

        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-80.2, 25.7], // lon, lat
          zoom: 13
        });

      // Adding Fish Kill featurelayer from feature service
        const FishKill = new FeatureLayer({ 
          url: "https://atoll.floridamarine.org/arcgis/rest/services/Projects_FWC/FishKills_forDEP_WQDashboard/FeatureServer/1",
          title: "Fish Kill Reports",
          outfields: ["Species","SuspectedCause", "DateOfCall"],
          popuptemplate: popuptemplate
         });

      // Adding Algal Bloom featurelayer from feature service
        const AlgalBloom = new FeatureLayer({ 
          url: "https://services1.arcgis.com/nRHtyn3uE1kyzoYc/arcgis/rest/services/AlgalBloom_Final_View/FeatureServer/0",
          title: "Algal Bloom Reports",
          outfields: ["BloomObserved","AlgalIDResult","SampleDateTime"],
          popuptemplate: popuptemplate
        });

      // Constructing the popup survey for marking marine pollution    
        const popupSurvey = {
          title: "<i>Marine Pollution Report</i>",
          content: "<b>Name:</b> {name}<br><b>Date:</b> {_date}<br><b>Time:</b> {time}<br>"
        }

      // Adding the Safety Survey feature layer from the survey123 results
        const MarineSurvey = new FeatureLayer({
          url: "https://services.arcgis.com/LBbVDC0hKPAnLRpO/arcgis/rest/services/survey123_d9a7dbeca58d4d7abb07500bad1eff47_results/FeatureServer",
          title: "Marine Pollution Report Survey",
          renderer: SurveyRenderer,
          outFields: ["type_of_incident","date_and_time_of_sighting", "any_wildlife_injured_or_killed_","types_of_wildlife_affected"],
          popupTemplate: popupSurvey
        });

      // Adding the important feature layers to the map
        map.addMany([FishKill, AlgalBloom, MarineSurvey]);

      // Create Search widget using custom SearchSource
        const searchWidget = new Search({
          view: view,
          sources: [ customSearchSource ],
          includeDefaultSources: false
        });

      // Add the search widget to the top left corner of the view
        view.ui.add(searchWidget, {
         position: "top-right"
        });

      // Creating the LayerList widget
        let layerList = new LayerList({
          view: view
        });
      });
    </script>

  </head>

  <body>
    <!-- Below is link to Survey123 Marine Report form and will show a 'Submit Report' button to user -->
    <a href="https://arcg.is/4raiq0" class="addRecordBtn">Submit Report</a>
    
    <div id="viewDiv"></div>

  </body>
</html>