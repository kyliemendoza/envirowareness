<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>GIS4102C Midterm - Marine Pollution Reports</title>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
      /* Adding CSS for survey button */
      .addRecordBtn {
        position: absolute;
        z-index: 10;
        top: 10px;
        right: 10px;
        background-color:#0079c1;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        text-decoration: none;
      }
        .addRecordBtn:hover {
          background-color: #005a87;
      }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
    <script src="https://js.arcgis.com/4.29/"></script>

    <script>
      require([
      "esri/config",
      "esri/Map",
      "esri/Graphic",
      "esri/request",
      "esri/views/MapView",
      "esri/widgets/Search",
      "esri/widgets/Locate",
      "esri/widgets/Search/SearchSource",
      "esri/geometry/geometryEngine",
      "esri/geometry/Point",
      "esri/layers/FeatureLayer"
      ], (
        esriconfig,
        Map,
        Graphic,
        esriRequest,
        MapView,
        Search,
        Locate,
        SearchSource,
        geometryEngine,
        Point,
        FeatureLayer
      ) => {

      // Set the API key for the ArcGIS API for JavaScript
        esriConfig.apiKey = "AAPK9c89b2be3b2847e5855098989dee99b2ti5ZLtJOzNptY3_yhg1lc2nqbYUD8RuNm4u3-LVBPsb_GdnzndOpiPIEc8_lM4bG";

        const map = new Map({
          basemap: "arcgis-topographic"
        });

        const view = new MapView({
          container: "viewDiv",
          map: map,
          center: [-80.2, 25.7], // lon, lat
          zoom: 13
        });

        const locateBtn = new Locate({ // Add the locate widget to the view
              view: view
            });

          view.ui.add(locateBtn, { // Add the locate widget to the top left corner of the view
            position: "top-left"
            });

        // Adding Fish Kill featurelayer from feature service
          const FishKill = new FeatureLayer({ 
            url: "https://atoll.floridamarine.org/arcgis/rest/services/Projects_FWC/FishKills_forDEP_WQDashboard/FeatureServer/1",
            title: "Fish Kill Reports",
            outfields: ["Species","SuspectedCause", "DateOfCall"],
            popuptemplate: popuptemplate
              });
          
            map.add(layer);

        // Adding Algal Bloom featurelayer from feature service
          const AlgalBloom = new FeatureLayer({ 
            url: "https://services1.arcgis.com/nRHtyn3uE1kyzoYc/arcgis/rest/services/AlgalBloom_Final_View/FeatureServer/0",
            title: "Algal Bloom Reports",
            outfields: ["BloomObserved","AlgalIDResult","SampleDateTime"],
            popuptemplate: popuptemplate
            });
          
            map.add(layer);

    // Constructing the popup survey for marking marine pollution    
const popupSurvey = {
  title: "<i>Marine Pollution Report</i>",
  content: "<b>Name:</b> {name}<br><b>Date:</b> {_date}<br><b>Time:</b> {time}<br>"
}

// Adding the Safety Survey feature layer from the survey123 results
const MarineSurvey = new FeatureLayer({
  url: "https://services.arcgis.com/LBbVDC0hKPAnLRpO/arcgis/rest/services/survey123_d9a7dbeca58d4d7abb07500bad1eff47_results/FeatureServer",
  title: "Marine Pollution Report Survey",
  renderer: SurveyRenderer,
  outFields: ["type_of_incident","date_and_time_of_sighting", "any_wildlife_injured_or_killed_","types_of_wildlife_affected"],
  popupTemplate: popupSurvey
});

        // Create Search widget using custom SearchSource
        const searchWidget = new Search({
          view: view,
          sources: [ customSearchSource ],
          includeDefaultSources: false
        });

        // Add the search widget to the top left corner of the view
        view.ui.add(searchWidget, {
          position: "top-right"
        });
      });
    </script>

  </head>

  <body>
    <!-- Below is link to Survey123 pollution form and will show an 'Add Record' button to user -->
    <a href="https://arcg.is/4raiq0">Submit Report</a> 
    
    <div id="viewDiv"></div>

  </body>
</html>